<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pen_Plotter_Term_Project: Term Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Pen_Plotter_Term_Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('page_1.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Term Project </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Sftw_ds"></a>
Software Design</h1>
<h2><a class="anchor" id="desc"></a>
Description of Software</h2>
<p >This software consists of a files all used within the multitasking <a class="el" href="main_8py.html" title="Executes Pen-Plotter function.">main.py</a> file used to execute the pen-plotting protocol. Our software makes use of driver files that are imported into our main file. These driver files are <a class="el" href="closedloop_8py.html" title="Driver class implementing a closed loop controller.">closedloop.py</a>, cotask.py, task_share.py, <a class="el" href="encoder__Ruiz__Martos_8py.html" title="Driver class for encoder project.">encoder_Ruiz_Martos.py</a> and <a class="el" href="motor__Ruiz__Martos_8py.html" title="Driver class that sets up and controls motors.">motor_Ruiz_Martos.py</a>. These driver files are used to implement closed loop control, shared variables and cooperative task management. These driver files also allow the control of both motors and encoders implemented in our design. A file named filereader.py is a file that is used to parse through hpgl files and convert them into encoder ticks. The contents of that file are used within the <a class="el" href="main_8py.html" title="Executes Pen-Plotter function.">main.py</a> file. The rest of the files are demo files used to check the response of all hardware. There are also hpgl files that were used to demo our pen plotter after being modified slightly to help with memory issues.</p>
<h2><a class="anchor" id="tsk_d"></a>
Task Diagram</h2>
<p >This task diagram below shows our software structure for how to acheive the overall functions of the pen plotter task. There are three main tasks involved in our pen plotter design. The encoder task continuously updates the encoder positions and the solenoid actuation. It is also responsible for detecting the limit switches and zeroing the position of each encoder when those limit switches are pressed. This task shares the encoder positions with the controller task. The controller task is responsible for calculating the duty cycles for each motor using the target position as reference. The controller task is the highest priority because it is the heart of the multitasking operation. It sends the duty cycles to the motor task and indicates when the execution of the entire system is ready. The motor task is the simplest task. It constantly applies the duty cycle shared from the controller task to each of the motors. It is responsible for enabling and disabling the motors. Before the multitasking is executed, the main file asks for the name of an hpgl file. It parses through the hpgl file and converts the hpgl coordinates to our system's relevant coordinates (encoder positions). After it calculates all the positions, it starts the multitasking operation.</p>
<h2>Task Diagram</h2>
<p ><img src="Pen_Plotter_Task_Diagram.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="FSM_dr"></a>
Encoder Task FSM</h2>
<p >This Finite State Machine is for the encoder task. The FSM starts out waiting for both limit switches to be pressed. The multitasking operation starts with both motors reaching their home positions, which is where the limit switches are located. Once both limit switches are pressed in, it sets both encoder positions to 0 and moves to state 1. State 1 is where the encoder task will stay until the end of the pen plotter execution. This state updates both encoder positions and writes them to their respective shared variables in order to share it with other tasks. This state also updates the solenoid actuation based on the shared variable being set in the main program. Once the terminate flag gets raised, the encoder FSM changes to state 3 which is the termination state. The encoder releases the solenoid activation at this state.</p>
<p ><img src="FSM_Encoder.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="FSM_c"></a>
Controller Task</h2>
<p >This Finite State Machine is for the Controller task. State 0 sets both motors duty cycles at -50 until the arm and the belt hit the limit switches. If one hits the limit switch, that motor is disabled but the other motor will continue to run until it has also hit the limit switch. If both limit switches are hit, the controller task moves onto state 2. State 2 just initializes the execution protocol by raising the execution flag. Once the execution flag is raised, the controller moves on to state 3. This state is where the controller continuously updates the duty cycles of both motors by implementing a proportional controller. It updates the duty cycle shared variables and raises the next point flag once both encoders reach within a certain threshold of their designated point. This cycle continues once there is no points left and the terminate flag is raised. Once the terminate flag is raised, controller will move to state 4, which is the terminate state. This state stops both motors and lowers the execute flag.</p>
<p ><img src="FSM_Controller.png" alt="" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Mar 15 2022 15:37:28 for Pen_Plotter_Term_Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
